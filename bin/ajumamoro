#!/usr/bin/env php
<?php

require "vendor/autoload.php";

use clearice\ClearIce;
use ntentan\panie\Container;
use Monolog\Logger;
use Monolog\Handler\StreamHandler;

$container = new Container();
$container->bind(Psr\Log\LoggerInterface::class)->to(function($container){
    $logger = new Monolog\Logger("ajumamoro");
    $logger->pushHandler(new StreamHandler(STDOUT, Logger::INFO));
    return $logger;
})->asSingleton();

ClearIce::setContainer($container);
ClearIce::addCommands(
    ajumamoro\commands\Start::class,
    ajumamoro\commands\Stop::class
);

ClearIce::addHelp();
ClearIce::setStrict(true);
ClearIce::setDescription("Ajumamoro is a tool for running background tasks in PHP apps.");
ClearIce::setUsage("[command] [options]");

//try{
    $arguments = ClearIce::parse();
/*}
catch(\Exception $e)
{
    fputs(STDERR, "ajumamor failed to start: {$e->getMessage()}\n");
    die();
}*/

if(count($arguments) === 0 || $arguments['__command__'] == '')
{
    echo ClearIce::getHelpMessage();
}
else if(!isset($arguments['__command__']) && isset($arguments['stand_alones']))
{
    echo ClearIce::getHelpMessage();
}
